# ğŸ”„ Complete Data Flow Documentation

## Table of Contents
1. [User Registration Flow](#user-registration-flow)
2. [Team Creation & ID Generation](#team-creation--id-generation)
3. [Submission Flow](#submission-flow)
4. [File Upload Flow](#file-upload-flow)
5. [Admin Review Flow](#admin-review-flow)
6. [Database Relationships](#database-relationships)

---

## 1. User Registration Flow

### Step-by-Step Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER REGISTRATION FLOW                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: User Enters Email
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ User enters email on /register
â”‚ (Browser)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ POST /api/send-otp                    â† REST endpoint
     â”‚ { email: "user@example.com", purpose: "REGISTRATION" }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ 1. Rate limit check (IP: 10/min, Email: 3/min)
â”‚  (Next.js) â”‚ 2. Validate input with Zod
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ 3. Generate 6-digit OTP
     â”‚         4. SHA-256 hash the OTP before storage
     â”‚         5. Upsert hashed OTP into Database
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ Otp.upsert({
â”‚   (Neon)   â”‚   where: { email_purpose: { email, purpose } },
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   create/update: {
                   otp: SHA256("123456"),  â† Hashed, NOT plain text
                   expiresAt: now + 10 min,
                   verified: false,
                   attempts: 0
                 }
               })
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Resend   â”‚ Send email with plain-text OTP
â”‚  (Email)   â”‚ Subject: "Your Verification Code"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Body: "Your OTP: 123456"


Step 2: User Verifies OTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ User enters OTP
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ POST /api/verify-otp                  â† REST endpoint
     â”‚ { email: "user@example.com", otp: "123456", purpose: "REGISTRATION" }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ 1. Rate limit check (IP: 20/min)
â”‚  (Next.js) â”‚ 2. Validate input with Zod
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ 3. Hash user input: SHA256("123456")
     â”‚         4. Compare hash with stored hash in DB
     â”‚         5. Check expiration + attempt count (max 5)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ 1. Fetch OTP record by email + purpose
â”‚   (Neon)   â”‚ 2. Compare: SHA256(input) === stored hash
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ 3. Mark OTP as verified
     â”‚         4. Find or create User
     â”‚         5. Create Session
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ User Record Created:
â”‚   (Neon)   â”‚ {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   id: "clx1234567890",  â† Generated by Prisma
                 email: "user@example.com",
                 emailVerified: true,
                 role: "PARTICIPANT",
                 createdAt: "2026-02-19T10:30:00Z"
               }
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ Session Record Created:
â”‚   (Neon)   â”‚ {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   id: "clx9876543210",
                 userId: "clx1234567890",
                 token: "abc123...xyz",  â† Random 32-byte hex
                 expiresAt: "2026-03-21T10:30:00Z"  â† 30 days
               }
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ Receives:
â”‚ (Browser)â”‚ {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   user: { id, email, name, role },
               token: "abc123...xyz",
               expiresAt: "2026-03-21T10:30:00Z"
             }
             
             Stores token in:
             - localStorage.setItem("session_token", token)
             - Cookie (httpOnly for security)
```

---


## 2. Team Creation & ID Generation

### When & How Team ID is Generated

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TEAM CREATION & ID GENERATION                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: User Fills Team Registration Form
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ User fills form on /register
â”‚ (Browser)â”‚ - Team name
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ - Track (IdeaSprint/BuildStorm)
     â”‚       - Leader info
     â”‚       - Member 2, 3, 4 info (optional)
     â”‚       - Submission details
     â”‚
     â”‚ POST /api/register                     â† REST endpoint
     â”‚ {
     â”‚   idempotencyKey: "550e8400-...",  â† UUID generated once per form session
     â”‚   teamName: "Team Phoenix",
     â”‚   track: "IdeaSprint: Build MVP in 24 Hours",
     â”‚   teamSize: "2 Members",
     â”‚   leaderName: "John",
     â”‚   leaderEmail: "leader@example.com",
     â”‚   leaderMobile: "9876543210",
     â”‚   leaderCollege: "IIT Delhi",
     â”‚   leaderDegree: "B.Tech CSE",
     â”‚   member2Email: "member2@example.com",
     â”‚   member2Name: "Jane",
     â”‚   ideaTitle: "AI-Powered Study Assistant",
     â”‚   problemStatement: "Students struggle with...",
     â”‚   hearAbout: "Social Media",
     â”‚   additionalNotes: "Excited to participate!"
     â”‚ }
     â”‚
     â”‚ Headers:
     â”‚   Authorization: Bearer <session_token>   â† From verify-otp
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ REST Handler: POST /api/register
â”‚  (Next.js) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ 1. Rate limit check (IP: 5/hour)
     â”‚         2. Validate input with Zod schema
     â”‚         3. Check idempotency key (return cached if duplicate)
     â”‚         4. Verify OTP was verified for leader email
     â”‚         5. Map track string â†’ enum (IDEA_SPRINT / BUILD_STORM)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE TRANSACTION                     â”‚
â”‚                    (All or Nothing)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Transaction Step 0: Duplicate Check (inside transaction)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ Team.findFirst({
â”‚   (Neon)   â”‚   where: {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     track: "IDEA_SPRINT",
                   members: {
                     some: {
                       user: { email: "leader@example.com" },
                       role: "LEADER"
                     }
                   }
                 }
               })
               
               If exists â†’ throw DUPLICATE_REGISTRATION (409)

Transaction Step 1: Find or Create Users (for each member)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ For each member:
â”‚   (Neon)   â”‚ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ // Find existing user first
               User.findUnique({ where: { email } })
               
               // If exists â†’ UPDATE (merge new data)
               User.update({
                 where: { email: "leader@example.com" },
                 data: {
                   name: "John" || existingUser.name,
                   college: "IIT Delhi" || existingUser.college,
                   ...
                 }
               })
               
               // If not â†’ CREATE
               User.create({
                 data: {
                   email: "leader@example.com",
                   name: "John",
                   emailVerified: true,  â† Leader verified via OTP
                   role: "PARTICIPANT"
                 }
               })
               
               Result:
               - Leader: usr_clx1111111
               - Member2: usr_clx2222222


Transaction Step 2: Create Team
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ Team.create({
â”‚   (Neon)   â”‚   data: {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     id: "team_clx3333333",  â† Generated by Prisma (cuid)
                   name: "Team Phoenix",
                   track: "IDEA_SPRINT",
                   status: "PENDING",  â† Initial status (ready for review)
                   size: 2,
                   college: "IIT Delhi",  â† From leader's profile
                   hearAbout: "Social Media",
                   additionalNotes: "Excited to participate!",
                   createdBy: "usr_clx1111111",  â† Leader's user ID
                   createdAt: "2026-02-19T10:35:00Z"
                 }
               })
               
               âœ… TEAM ID GENERATED: "team_clx3333333"


Transaction Step 3: Create Team Members
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ TeamMember.create({
â”‚   (Neon)   â”‚   data: {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     id: "tm_clx4444444",  â† Generated by Prisma
                   userId: "usr_clx1111111",  â† Leader
                   teamId: "team_clx3333333",  â† Links to team
                   role: "LEADER",
                   joinedAt: "2026-02-19T10:35:00Z"
                 }
               })
               
               TeamMember.create({
                 data: {
                   id: "tm_clx5555555",
                   userId: "usr_clx2222222",  â† Member 2
                   teamId: "team_clx3333333",  â† Same team
                   role: "MEMBER",
                   joinedAt: "2026-02-19T10:35:00Z"
                 }
               })


Transaction Step 4: Create Submission (with data from form)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ Submission.create({
â”‚   (Neon)   â”‚   data: {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     id: "sub_clx6666666",  â† Generated by Prisma
                   teamId: "team_clx3333333",  â† Links to team
                   ideaTitle: "AI-Powered Study Assistant",
                   problemStatement: "Students struggle with...",
                   proposedSolution: "We propose...",
                   targetUsers: "College students",
                   expectedImpact: "Help 10K students",
                   techStack: "Next.js, Python, OpenAI",
                   createdAt: "2026-02-19T10:35:00Z"
                 }
               })


Transaction Step 5: Log Activity
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ ActivityLog.create({
â”‚   (Neon)   â”‚   data: {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     id: "log_clx7777777",
                   userId: "usr_clx1111111",
                   action: "team.created",
                   entity: "Team",
                   entityId: "team_clx3333333",
                   metadata: { teamName: "Team Phoenix", track: "IDEA_SPRINT" },
                   ipAddress: "192.168.1.1",
                   createdAt: "2026-02-19T10:35:00Z"
                 }
               })

âœ… TRANSACTION COMMITTED - All records created atomically


Step 2: Response to Client
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ Returns JSON response:
â”‚  (REST)    â”‚ (Also cached by idempotency key for retry safety)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ Receives:
â”‚ (Browser)â”‚ {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   success: true,
               message: "Registration successful!",
               data: {
                 teamId: "team_clx3333333",  â† TEAM ID
                 submissionId: "sub_clx6666666",
                 teamName: "Team Phoenix",
                 track: "IDEA_SPRINT"
               }
             }
             
             Client:
             - Shows success screen (ThankYouScreen component)
             - Idempotency key prevents duplicate submissions on retry
```

### ID Generation Details

| Entity | ID Format | Generated By | When | Example |
|--------|-----------|--------------|------|---------|
| **User** | `usr_` + cuid | Prisma | On first OTP verification | `usr_clx1234567890` |
| **Team** | `team_` + cuid | Prisma | On team.create() | `team_clx3333333` |
| **TeamMember** | `tm_` + cuid | Prisma | When adding member to team | `tm_clx4444444` |
| **Submission** | `sub_` + cuid | Prisma | With team creation | `sub_clx6666666` |
| **File** | `file_` + cuid | Prisma | On file upload | `file_clx8888888` |
| **Session** | `sess_` + cuid | Prisma | On login | `sess_clx9999999` |

**CUID Format:** Collision-resistant unique identifier
- Length: 25 characters
- Format: `c` + timestamp + random
- Example: `clx1234567890abcdefghij`

---


## 3. Submission Flow

### How Submission Data Flows

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUBMISSION DATA FLOW                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: User Updates Submission
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ User fills submission form
â”‚ (Browser)â”‚ /team/team_clx3333333/submission
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ PUT /api/trpc/team.updateSubmission
     â”‚ {
     â”‚   teamId: "team_clx3333333",
     â”‚   data: {
     â”‚     ideaTitle: "AI-Powered Study Assistant",
     â”‚     problemStatement: "Students struggle with...",
     â”‚     proposedSolution: "We propose...",
     â”‚     targetUsers: "College students",
     â”‚     expectedImpact: "Help 10K students",
     â”‚     techStack: "Next.js, Python, OpenAI"
     â”‚   }
     â”‚ }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ 1. Verify user is team member
â”‚  (tRPC)    â”‚ 2. Check team status (must be DRAFT/PENDING)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ 3. Update submission
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ Submission.update({
â”‚   (Neon)   â”‚   where: { teamId: "team_clx3333333" },
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   data: {
                   ideaTitle: "AI-Powered Study Assistant",
                   problemStatement: "Students struggle with...",
                   proposedSolution: "We propose...",
                   targetUsers: "College students",
                   expectedImpact: "Help 10K students",
                   techStack: "Next.js, Python, OpenAI",
                   lastEditedAt: "2026-02-19T11:00:00Z",
                   updatedAt: "2026-02-19T11:00:00Z"
                 }
               })


Step 2: Submit for Review
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ User clicks "Submit for Review"
â”‚ (Browser)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ POST /api/trpc/team.submitForReview
     â”‚ { teamId: "team_clx3333333" }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ 1. Validate submission is complete
â”‚  (tRPC)    â”‚ 2. Update submission.submittedAt
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ 3. Update team.status to PENDING
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ Transaction:
â”‚   (Neon)   â”‚ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 1. Submission.update({
                   where: { teamId: "team_clx3333333" },
                   data: {
                     submittedAt: "2026-02-19T11:15:00Z"
                   }
                 })
                 
               2. Team.update({
                   where: { id: "team_clx3333333" },
                   data: {
                     status: "PENDING"  â† Changed from DRAFT
                   }
                 })
                 
               3. Notification.create({
                   userId: "usr_clx1111111",  â† Leader
                   type: "STATUS_UPDATE",
                   title: "Submission Received",
                   message: "Your team submission is under review",
                   createdAt: "2026-02-19T11:15:00Z"
                 })
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Resend   â”‚ Send confirmation email to all members
â”‚  (Email)   â”‚ Subject: "Submission Received - Team Phoenix"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Body: "Your submission is now under review..."
```

---

## 4. File Upload Flow

### Complete File Upload Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FILE UPLOAD FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Request Upload Signature
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ User selects file (idea-deck.pdf, 5MB)
â”‚ (Browser)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ POST /api/upload/signature
     â”‚ { folder: "registrations/ideasprint" }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ Generate Cloudinary signature
â”‚  (Next.js) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudinary â”‚ Generate presigned upload URL
â”‚   (CDN)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ Receives:
â”‚ (Browser)â”‚ {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   signature: "abc123...",
               timestamp: 1708340100,
               cloudName: "indianext",
               apiKey: "123456789",
               folder: "registrations/ideasprint"
             }


Step 2: Upload File Directly to Cloudinary
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ Upload file directly (bypasses server)
â”‚ (Browser)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ POST https://api.cloudinary.com/v1_1/indianext/auto/upload
     â”‚ FormData:
     â”‚ - file: [binary data]
     â”‚ - signature: "abc123..."
     â”‚ - timestamp: 1708340100
     â”‚ - folder: "registrations/ideasprint"
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudinary â”‚ 1. Validate signature
â”‚   (CDN)    â”‚ 2. Upload file
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ 3. Process (optimize, generate thumbnail)
     â”‚         4. Store in CDN
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ Receives:
â”‚ (Browser)â”‚ {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   secure_url: "https://res.cloudinary.com/.../idea-deck.pdf",
               public_id: "registrations/ideasprint/abc123",
               format: "pdf",
               bytes: 5242880,  â† 5MB
               width: null,
               height: null,
               created_at: "2026-02-19T11:20:00Z"
             }


Step 3: Save File Metadata to Database
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ Save file info
â”‚ (Browser)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ POST /api/trpc/file.create
     â”‚ {
     â”‚   submissionId: "sub_clx6666666",
     â”‚   fileName: "idea-deck.pdf",
     â”‚   fileUrl: "https://res.cloudinary.com/.../idea-deck.pdf",
     â”‚   fileKey: "registrations/ideasprint/abc123",
     â”‚   fileSize: 5242880,
     â”‚   mimeType: "application/pdf",
     â”‚   category: "IDEA_DECK"
     â”‚ }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ Validate and save
â”‚  (tRPC)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ File.create({
â”‚   (Neon)   â”‚   data: {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     id: "file_clx8888888",  â† Generated
                   submissionId: "sub_clx6666666",
                   fileName: "idea-deck.pdf",
                   fileUrl: "https://res.cloudinary.com/.../idea-deck.pdf",
                   fileKey: "registrations/ideasprint/abc123",
                   fileSize: 5242880,
                   mimeType: "application/pdf",
                   category: "IDEA_DECK",
                   scanStatus: "PENDING",  â† For virus scan
                   uploadedAt: "2026-02-19T11:20:00Z",
                   uploadedBy: "usr_clx1111111"
                 }
               })
               
               âœ… FILE ID GENERATED: "file_clx8888888"


Step 4: (Optional) Virus Scan
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backgroundâ”‚ Async job scans file
â”‚   Worker   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ File.update({
â”‚   (Neon)   â”‚   where: { id: "file_clx8888888" },
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   data: {
                   scanStatus: "CLEAN",  â† or "INFECTED"
                   scanResult: "No threats detected"
                 }
               })
```

### File Storage Structure in Cloudinary

```
indianext-uploads/
â”œâ”€â”€ registrations/
â”‚   â”œâ”€â”€ ideasprint/
â”‚   â”‚   â”œâ”€â”€ team_clx3333333/
â”‚   â”‚   â”‚   â”œâ”€â”€ idea-deck.pdf          â† file_clx8888888
â”‚   â”‚   â”‚   â”œâ”€â”€ pitch-video.mp4        â† file_clx9999999
â”‚   â”‚   â”‚   â””â”€â”€ supporting-doc.pdf     â† file_clxaaaaaaa
â”‚   â”‚   â””â”€â”€ team_clx4444444/
â”‚   â”‚       â””â”€â”€ idea-deck.pdf
â”‚   â””â”€â”€ buildstorm/
â”‚       â”œâ”€â”€ team_clx5555555/
â”‚       â”‚   â”œâ”€â”€ demo-video.mp4
â”‚       â”‚   â””â”€â”€ architecture.png
â”‚       â””â”€â”€ team_clx6666666/
â”‚           â””â”€â”€ prototype.zip
â””â”€â”€ avatars/
    â”œâ”€â”€ usr_clx1111111.jpg
    â””â”€â”€ usr_clx2222222.jpg
```

---


## 5. Admin Review Flow

### How Admins Review and Approve Teams

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADMIN REVIEW FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Admin Views Teams List
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚ Opens /admin/teams
â”‚ Dashboardâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ GET /api/trpc/admin.getTeams
     â”‚ {
     â”‚   status: "PENDING",
     â”‚   track: "all",
     â”‚   page: 1,
     â”‚   pageSize: 50
     â”‚ }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ Query with filters
â”‚  (tRPC)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis    â”‚ Check cache first
â”‚  (Upstash) â”‚ Key: "teams:list:PENDING:all:1:50"
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ TTL: 60 seconds
     â”‚
     â”‚ Cache MISS
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ SELECT * FROM teams
â”‚   (Neon)   â”‚ WHERE status = 'PENDING'
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   AND deleted_at IS NULL
     â”‚         ORDER BY created_at DESC
     â”‚         LIMIT 50 OFFSET 0
     â”‚
     â”‚         Uses index: idx_teams_status_created_at
     â”‚         Query time: ~50ms
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis    â”‚ Cache result for 60 seconds
â”‚  (Upstash) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚ Receives list of 50 pending teams
â”‚ Dashboardâ”‚ [
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   {
                 id: "team_clx3333333",
                 name: "Team Phoenix",
                 track: "IDEA_SPRINT",
                 status: "PENDING",
                 college: "IIT Delhi",
                 size: 2,
                 members: [...],
                 submission: {...},
                 createdAt: "2026-02-19T10:35:00Z"
               },
               ...
             ]


Step 2: Admin Views Team Details
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚ Clicks on "Team Phoenix"
â”‚ Dashboardâ”‚ Opens /admin/teams/team_clx3333333
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ GET /api/trpc/admin.getTeamById
     â”‚ { id: "team_clx3333333" }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ Fetch complete team data
â”‚  (tRPC)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis    â”‚ Check cache
â”‚  (Upstash) â”‚ Key: "team:team_clx3333333"
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ TTL: 300 seconds (5 min)
     â”‚
     â”‚ Cache MISS
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ SELECT * FROM teams
â”‚   (Neon)   â”‚ WHERE id = 'team_clx3333333'
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ INCLUDE members, submission, files, comments, tags
     â”‚
     â”‚         Uses index: PRIMARY KEY (id)
     â”‚         Query time: ~20ms
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis    â”‚ Cache result
â”‚  (Upstash) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚ Sees complete team details:
â”‚ Dashboardâ”‚ - Team info
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ - All members with profiles
             - Complete submission
             - Uploaded files (with preview)
             - Previous comments
             - Tags


Step 3: Admin Reviews Submission
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚ Reviews:
â”‚ Dashboardâ”‚ - Idea title and description
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ - Problem statement
             - Proposed solution
             - Uploaded files (PDF viewer, video player)
             - Team member profiles


Step 4: Admin Approves Team
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚ Clicks "Approve"
â”‚ Dashboardâ”‚ Optionally adds review notes
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ POST /api/trpc/admin.updateTeamStatus
     â”‚ {
     â”‚   teamId: "team_clx3333333",
     â”‚   status: "APPROVED",
     â”‚   reviewNotes: "Great idea! Well presented."
     â”‚ }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server   â”‚ 1. Verify admin permissions
â”‚  (tRPC)    â”‚ 2. Update team status
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ 3. Log activity
     â”‚         4. Send notifications
     â”‚         5. Invalidate caches
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE TRANSACTION                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Transaction Step 1: Update Team
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ Team.update({
â”‚   (Neon)   â”‚   where: { id: "team_clx3333333" },
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   data: {
                   status: "APPROVED",  â† Changed from PENDING
                   reviewNotes: "Great idea! Well presented.",
                   reviewedBy: "usr_admin123",  â† Admin user ID
                   reviewedAt: "2026-02-19T14:30:00Z",
                   updatedAt: "2026-02-19T14:30:00Z"
                 }
               })


Transaction Step 2: Log Activity
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ ActivityLog.create({
â”‚   (Neon)   â”‚   data: {
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     id: "log_clxbbbbbb",
                   userId: "usr_admin123",
                   action: "team.status_updated",
                   entity: "Team",
                   entityId: "team_clx3333333",
                   metadata: {
                     previousStatus: "PENDING",
                     newStatus: "APPROVED",
                     reviewNotes: "Great idea! Well presented."
                   },
                   ipAddress: "192.168.1.100",
                   createdAt: "2026-02-19T14:30:00Z"
                 }
               })


Transaction Step 3: Create Notifications
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database  â”‚ For each team member:
â”‚   (Neon)   â”‚ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Notification.create({
                 data: {
                   id: "notif_clxcccccc",
                   userId: "usr_clx1111111",  â† Leader
                   type: "STATUS_UPDATE",
                   title: "Team Approved! ğŸ‰",
                   message: "Congratulations! Team Phoenix has been approved.",
                   link: "/team/team_clx3333333",
                   read: false,
                   createdAt: "2026-02-19T14:30:00Z"
                 }
               })
               
               Notification.create({
                 data: {
                   id: "notif_clxdddddd",
                   userId: "usr_clx2222222",  â† Member 2
                   type: "STATUS_UPDATE",
                   title: "Team Approved! ğŸ‰",
                   message: "Congratulations! Team Phoenix has been approved.",
                   link: "/team/team_clx3333333",
                   read: false,
                   createdAt: "2026-02-19T14:30:00Z"
                 }
               })

âœ… TRANSACTION COMMITTED


Step 5: Invalidate Caches
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis    â”‚ Delete cached data:
â”‚  (Upstash) â”‚ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ DEL "team:team_clx3333333"
               DEL "teams:list:PENDING:*"
               DEL "teams:list:APPROVED:*"
               DEL "stats:dashboard"


Step 6: Send Email Notifications
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Queue    â”‚ Add to email queue (async)
â”‚  (BullMQ)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Worker   â”‚ Process email job
â”‚ (Background)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Resend   â”‚ Send email to all members:
â”‚  (Email)   â”‚ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ To: leader@example.com, member2@example.com
               Subject: "Team Approved - Team Phoenix"
               Body: "Congratulations! Your team has been approved..."
               
               Email sent at: 2026-02-19T14:30:05Z


Step 7: Real-time Update (Optional)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Pusher   â”‚ Broadcast to connected clients
â”‚ (WebSocket)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ Team members see real-time notification
â”‚ (Browser)â”‚ Toast: "ğŸ‰ Your team has been approved!"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Badge on notification icon updates
```

---


## 6. Database Relationships

### Complete Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE RELATIONSHIPS (ERD)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ id (PK)          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ email (UNIQUE)   â”‚          â”‚
â”‚ name             â”‚          â”‚
â”‚ phone            â”‚          â”‚
â”‚ college          â”‚          â”‚
â”‚ role             â”‚          â”‚
â”‚ emailVerified    â”‚          â”‚
â”‚ createdAt        â”‚          â”‚
â”‚ updatedAt        â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                    â”‚
         â”‚ 1:N                â”‚ N:1
         â”‚                    â”‚
         â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   TeamMember     â”‚          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
â”‚ id (PK)          â”‚          â”‚
â”‚ userId (FK) â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ teamId (FK) â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ role             â”‚          â”‚
â”‚ joinedAt         â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                              â”‚
                              â”‚ N:1
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      Team        â”‚
                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
                    â”‚ id (PK)          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ name             â”‚          â”‚
                    â”‚ track            â”‚          â”‚
                    â”‚ status           â”‚          â”‚
                    â”‚ size             â”‚          â”‚
                    â”‚ college          â”‚          â”‚
                    â”‚ createdBy (FK)   â”‚          â”‚
                    â”‚ reviewedBy       â”‚          â”‚
                    â”‚ createdAt        â”‚          â”‚
                    â”‚ updatedAt        â”‚          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                             â”‚                    â”‚
                             â”‚ 1:1                â”‚ 1:N
                             â”‚                    â”‚
                             â–¼                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
                    â”‚   Submission     â”‚          â”‚
                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
                    â”‚ id (PK)          â”‚          â”‚
                    â”‚ teamId (FK) â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ ideaTitle        â”‚
                    â”‚ problemStatement â”‚
                    â”‚ proposedSolution â”‚
                    â”‚ submittedAt      â”‚
                    â”‚ createdAt        â”‚
                    â”‚ updatedAt        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ 1:N
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      File        â”‚
                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
                    â”‚ id (PK)          â”‚
                    â”‚ submissionId (FK)â”‚
                    â”‚ fileName         â”‚
                    â”‚ fileUrl          â”‚
                    â”‚ fileKey          â”‚
                    â”‚ fileSize         â”‚
                    â”‚ mimeType         â”‚
                    â”‚ category         â”‚
                    â”‚ uploadedAt       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Additional Relationships:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Team        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Comment      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ id (PK)          â”‚
â”‚ teamId (FK)      â”‚
â”‚ authorId         â”‚
â”‚ content          â”‚
â”‚ isInternal       â”‚
â”‚ createdAt        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Team        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     TeamTag      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ id (PK)          â”‚
â”‚ teamId (FK)      â”‚
â”‚ tag              â”‚
â”‚ color            â”‚
â”‚ addedBy          â”‚
â”‚ addedAt          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Notification   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ id (PK)          â”‚
â”‚ userId (FK)      â”‚
â”‚ type             â”‚
â”‚ title            â”‚
â”‚ message          â”‚
â”‚ read             â”‚
â”‚ createdAt        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ActivityLog    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ id (PK)          â”‚
â”‚ userId (FK)      â”‚
â”‚ action           â”‚
â”‚ entity           â”‚
â”‚ entityId         â”‚
â”‚ metadata (JSON)  â”‚
â”‚ ipAddress        â”‚
â”‚ createdAt        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Session      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ id (PK)          â”‚
â”‚ userId (FK)      â”‚
â”‚ token (UNIQUE)   â”‚
â”‚ expiresAt        â”‚
â”‚ ipAddress        â”‚
â”‚ createdAt        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Otp        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ id (PK)          â”‚
â”‚ email            â”‚
â”‚ otp              â”‚
â”‚ purpose          â”‚
â”‚ expiresAt        â”‚
â”‚ verified         â”‚
â”‚ userId (FK)      â”‚
â”‚ createdAt        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Relationships Explained

| Relationship | Type | Description |
|--------------|------|-------------|
| **User â†” TeamMember** | 1:N | One user can be in multiple teams |
| **Team â†” TeamMember** | 1:N | One team has multiple members |
| **Team â†” Submission** | 1:1 | Each team has exactly one submission |
| **Submission â†” File** | 1:N | One submission can have multiple files |
| **Team â†” Comment** | 1:N | One team can have multiple comments |
| **Team â†” TeamTag** | 1:N | One team can have multiple tags |
| **User â†” Notification** | 1:N | One user can have multiple notifications |
| **User â†” Session** | 1:N | One user can have multiple active sessions |
| **User â†” ActivityLog** | 1:N | One user generates multiple activity logs |
| **User â†” Otp** | 1:N | One user can have multiple OTPs (different purposes) |

---

## 7. Complete Data Flow Timeline

### From Registration to Approval (Minute-by-Minute)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           COMPLETE TIMELINE: USER TO APPROVAL                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T+0:00 (10:30:00) - User Starts Registration
â”œâ”€ User visits /register
â”œâ”€ Enters email: leader@example.com
â””â”€ Clicks "Send OTP"

T+0:01 (10:30:01) - OTP Generation
â”œâ”€ Server generates OTP: "123456"
â”œâ”€ Stores in Redis: Key="otp:leader@example.com", TTL=600s
â”œâ”€ Stores in Database: otps table
â””â”€ Sends email via Resend

T+0:03 (10:30:03) - User Receives Email
â”œâ”€ Email delivered to inbox
â””â”€ User opens email, sees OTP: "123456"

T+0:04 (10:30:04) - User Verifies OTP
â”œâ”€ User enters OTP in form
â”œâ”€ Server validates OTP from Redis
â”œâ”€ Creates User record: usr_clx1111111
â”œâ”€ Creates Session: sess_clx9999999
â”œâ”€ Returns session token to client
â””â”€ Client stores token in localStorage

T+0:05 (10:30:05) - User Fills Team Form
â”œâ”€ User fills team name: "Team Phoenix"
â”œâ”€ Selects track: "IDEA_SPRINT"
â”œâ”€ Adds member 2: member2@example.com
â””â”€ Fills submission details

T+0:10 (10:30:10) - User Submits Form
â”œâ”€ Client sends POST /api/trpc/team.create
â””â”€ Server starts processing

T+0:10.1 (10:30:10.100) - Database Transaction Starts
â”œâ”€ Create/Find User for leader: usr_clx1111111
â”œâ”€ Create/Find User for member2: usr_clx2222222
â”œâ”€ Create Team: team_clx3333333 â† TEAM ID GENERATED
â”œâ”€ Create TeamMember (leader): tm_clx4444444
â”œâ”€ Create TeamMember (member2): tm_clx5555555
â”œâ”€ Create Submission: sub_clx6666666
â”œâ”€ Create ActivityLog: log_clx7777777
â””â”€ Transaction committed (all or nothing)

T+0:10.5 (10:30:10.500) - Response to Client
â”œâ”€ Server returns team data with ID: team_clx3333333
â”œâ”€ Client stores team ID
â””â”€ Redirects to /team/team_clx3333333

T+0:15 (10:30:15) - User Uploads Files
â”œâ”€ User selects idea-deck.pdf (5MB)
â”œâ”€ Client requests upload signature
â”œâ”€ Server generates Cloudinary signature
â”œâ”€ Client uploads directly to Cloudinary
â”œâ”€ Cloudinary processes file
â”œâ”€ Client saves file metadata to database
â””â”€ File record created: file_clx8888888

T+0:20 (10:30:20) - User Completes Submission
â”œâ”€ User fills all submission fields
â”œâ”€ Client sends PUT /api/trpc/team.updateSubmission
â”œâ”€ Server updates submission record
â””â”€ submission.lastEditedAt = 10:30:20

T+0:25 (10:30:25) - User Submits for Review
â”œâ”€ User clicks "Submit for Review"
â”œâ”€ Client sends POST /api/trpc/team.submitForReview
â”œâ”€ Server validates submission is complete
â”œâ”€ Updates submission.submittedAt = 10:30:25
â”œâ”€ Updates team.status = "PENDING"
â”œâ”€ Creates notifications for all members
â”œâ”€ Sends confirmation emails
â””â”€ Team is now in review queue

T+4:00:00 (14:30:00) - Admin Reviews Team
â”œâ”€ Admin opens /admin/teams
â”œâ”€ Sees "Team Phoenix" in PENDING list
â”œâ”€ Clicks to view details
â”œâ”€ Reviews submission and files
â””â”€ Decides to approve

T+4:00:30 (14:30:30) - Admin Approves Team
â”œâ”€ Admin clicks "Approve"
â”œâ”€ Adds review notes: "Great idea!"
â”œâ”€ Client sends POST /api/trpc/admin.updateTeamStatus
â”œâ”€ Server starts transaction:
â”‚  â”œâ”€ Updates team.status = "APPROVED"
â”‚  â”œâ”€ Sets team.reviewedBy = admin user ID
â”‚  â”œâ”€ Sets team.reviewedAt = 14:30:30
â”‚  â”œâ”€ Creates activity log
â”‚  â”œâ”€ Creates notifications for all members
â”‚  â””â”€ Transaction committed
â”œâ”€ Invalidates Redis caches
â”œâ”€ Queues approval emails
â””â”€ Broadcasts real-time update (WebSocket)

T+4:00:31 (14:30:31) - Members Notified
â”œâ”€ Email sent to leader@example.com
â”œâ”€ Email sent to member2@example.com
â”œâ”€ In-app notifications created
â”œâ”€ Real-time toast shown (if online)
â””â”€ Badge count updated

T+4:00:32 (14:30:32) - Process Complete
â””â”€ Team Phoenix is now APPROVED âœ…


SUMMARY:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Registration to Submission:  25 seconds
Submission to Admin Review:  ~4 hours (varies)
Admin Review to Approval:    30 seconds
Total Time:                  ~4 hours 25 minutes

IDs Generated:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
usr_clx1111111  - Leader User
usr_clx2222222  - Member 2 User
team_clx3333333 - Team (PRIMARY ID)
tm_clx4444444   - Leader TeamMember
tm_clx5555555   - Member 2 TeamMember
sub_clx6666666  - Submission
file_clx8888888 - Uploaded File
sess_clx9999999 - Session
log_clx7777777  - Activity Log
notif_clxcccccc - Notification (Leader)
notif_clxdddddd - Notification (Member 2)
```

---

## 8. Performance & Capacity

> **Note:** The numbers below are design targets, not measured benchmarks.
> Run actual load tests before launch to validate.

### Indexed Query Targets

All high-traffic queries use indexed columns (see `schema.prisma` indexes).
Expected response times under normal load:

| Operation | Target P95 Latency |
|-----------|-------------------|
| Find team by ID (indexed PK) | < 10ms |
| List pending teams (indexed status) | < 50ms |
| Find user's teams (indexed userId) | < 30ms |
| Search teams by name (indexed) | < 100ms |
| Get team with members (join) | < 50ms |

### Capacity Targets

| Metric | Current Estimate | Neon Free Tier Limit |
|--------|-----------------|---------------------|
| Teams | ~100 | 50,000+ |
| Users | ~400 | 200,000+ |
| Database Size | ~50 MB | 0.5 GB |
| API Requests/min | ~50 | Depends on hosting |

### Rate Limits (Configured)

| Endpoint | IP Limit | Email Limit | Window |
|----------|----------|-------------|--------|
| `/api/send-otp` | 10/min | 3/min | 60s |
| `/api/verify-otp` | 20/min | â€” | 60s |
| `/api/register` | 5/hour | â€” | 3600s |

---

## 9. Error Handling & Rollback

### Transaction Rollback Example

```
If ANY step fails during team creation:

Transaction Step 1: Create User âœ…
Transaction Step 2: Create Team âœ…
Transaction Step 3: Create TeamMember âŒ FAILS
Transaction Step 4: Create Submission (not executed)

Result: ALL changes rolled back
- User creation: REVERTED
- Team creation: REVERTED
- Database state: UNCHANGED
- User sees error message
- Can retry safely
```

### Retry Logic

```typescript
// Automatic retry with exponential backoff
async function createTeamWithRetry(data, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await prisma.team.create({ data });
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await sleep(Math.pow(2, i) * 1000); // 1s, 2s, 4s
    }
  }
}
```

---

**This completes the comprehensive data flow documentation!** ğŸ‰

Every ID generation, database transaction, cache operation, and API call is documented with exact timing and flow.
